<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>피카츄 구조대 - 명예의 전당 에디션</title>
    <style>
        /* 1. 전체 웹 배경: 숲 사진 다시 적용 */
        body {
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background: #050505 url('PIC1.png') no-repeat center center fixed;
            background-size: cover;
            overflow: hidden; font-family: 'Malgun Gothic', sans-serif;
        }

        /* 2. 메인 게임기 프레임 */
        .main-container {
            display: flex; gap: 0; padding: 20px;
            background: rgba(15, 15, 15, 0.92);
            backdrop-filter: blur(10px);
            border-radius: 35px; border: 4px solid #ffd700;
            box-shadow: 0 30px 100px rgba(0,0,0,1);
            z-index: 100;
        }

        /* 3. 게임 화면 (800x600 완전 고정) */
        .game-view { 
            position: relative; width: 800px; height: 600px; 
            background: #000; border-radius: 15px; overflow: hidden;
            border: 2px solid #333;
        }
        canvas { display: block; width: 800px; height: 600px; }

        /* 4. 우측 사이드바 UI (한글) */
        .sidebar {
            width: 250px; height: 600px; background: rgba(0, 0, 0, 0.7);
            padding: 20px; display: flex; flex-direction: column;
            border-left: 2px solid #ffd700; box-sizing: border-box; color: white;
        }
        .sidebar h2 { color: #ffd700; text-align: center; border-bottom: 2px solid #ffd700; padding-bottom: 15px; margin: 0; }
        #companion-list { list-style: none; padding: 0; margin-top: 20px; overflow-y: auto; flex-grow: 1; }
        .comp-item { 
            display: flex; align-items: center; background: rgba(255,255,255,0.05); 
            margin-bottom: 10px; padding: 8px; border-radius: 12px; 
            border: 1px solid rgba(255, 215, 0, 0.2); 
        }
        .comp-item img { width: 40px; height: 40px; margin-right: 12px; }

        /* 시작 버튼 오버레이 */
        #overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column; 
            justify-content: center; align-items: center; z-index: 1000; 
        }
        #start-btn { 
            padding: 20px 60px; font-size: 30px; cursor: pointer; 
            background: #ffd700; border: none; border-radius: 20px; 
            font-weight: bold; box-shadow: 0 0 30px gold; color: #000;
            transition: 0.2s;
        }
        #start-btn:hover { transform: scale(1.1); }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="game-view">
            <canvas id="game" width="800" height="600"></canvas>
            
            <div id="overlay">
                <h1 style="color: #ffd700; font-size: 35px; text-shadow: 0 0 15px gold;">⚡ 숲의 구조대 최종 작전 ⚡</h1>
                <p style="color: white; margin-bottom: 30px;">1000점마다 동료를 구하고 쇼케이스를 밝히세요!</p>
                <button id="start-btn" onclick="startGame()">모험 시작</button>
            </div>

            <div style="position: absolute; top: 20px; left: 20px; color: #ffd700; font-size: 24px; font-weight: bold; pointer-events: none; text-shadow: 2px 2px 4px #000;">
                점수: <span id="score">0</span>
            </div>
        </div>

        <div class="sidebar">
            <h2>구조 로그</h2>
            <ul id="companion-list">
                <p id="empty-msg" style="text-align:center; opacity:0.3; margin-top:100px;">데이터 수집 중...</p>
            </ul>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const listEl = document.getElementById('companion-list');
        const scoreEl = document.getElementById('score');

        // 이미지 및 오디오 설정
        const img = { bg: new Image(), player: new Image(), enemy: new Image() };
        img.bg.src = 'PIC1.png';
        img.player.src = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png';
        img.enemy.src = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/92.png';

        const bgm = new Audio('BGM1.mp3');
        bgm.loop = true;

        // 영역 정의 (고정)
        const BATTLE_W = 550; // 왼쪽 숲 전투 구역
        const SHOW_W = 250;   // 오른쪽 검은 쇼케이스 구역

        let player = { x: 275, y: 300, spd: 8 };
        let enemies = [], bullets = [], keys = {}, score = 0, gameActive = false, lastRescue = 0;
        let gallery = []; // 쇼케이스에 빛날 동료들

        function startGame() {
            document.getElementById('overlay').style.display = 'none';
            gameActive = true;
            
            // 음악 재생 시도
            bgm.play().catch(e => console.log("음악 재생 차단됨: 클릭 후 재생 가능"));
            
            requestAnimationFrame(loop);
        }

        function addCompanion() {
            const empty = document.getElementById('empty-msg'); if(empty) empty.remove();
            const id = Math.floor(Math.random() * 150) + 1;
            const companionImg = new Image();
            companionImg.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
            
            let count = gallery.length;
            let col = count % 3;
            let row = Math.floor(count / 3);
            
            // 쇼케이스(550px 이후) 내부의 고정 위치 계산
            gallery.push({
                img: companionImg,
                x: BATTLE_W + 40 + (col * 85),
                y: 80 + (row * 90)
            });

            // 우측 로그 업데이트
            const li = document.createElement('li');
            li.className = 'comp-item';
            li.innerHTML = `<img src="${companionImg.src}"><span>동료 데이터 확보</span>`;
            listEl.prepend(li);
        }

        // 키 입력 처리
        window.onkeydown = (e) => { 
            keys[e.key.toLowerCase()] = true; 
            if(e.code === 'Space' && gameActive) bullets.push({x: player.x, y: player.y, spd: 12}); 
        };
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        function loop() {
            if(!gameActive) return;

            // 1. 플레이어 이동 및 경계 제한 (숲 안에서만!)
            if (keys['w']) player.y -= player.spd; if (keys['s']) player.y += player.spd;
            if (keys['a']) player.x -= player.spd; if (keys['d']) player.x += player.spd;
            
            player.x = Math.max(45, Math.min(player.x, BATTLE_W - 45));
            player.y = Math.max(45, Math.min(player.y, 600 - 45));

            // 2. 적 생성 (전투 구역 상단에서만)
            if (Math.random() < 0.03) enemies.push({ x: Math.random() * (BATTLE_W - 80) + 40, y: -50, spd: 3 + Math.random() * 2 });
            
            // 3. 총알 이동 및 충돌
            bullets.forEach((b, bi) => { 
                b.y -= b.spd; 
                enemies.forEach((en, ei) => { if (Math.hypot(b.x - en.x, b.y - en.y) < 40) { enemies.splice(ei, 1); bullets.splice(bi, 1); score += 200; }}); 
            });

            // 4. 1000점마다 동료 구조
            if (score >= lastRescue + 1000) { addCompanion(); lastRescue += 1000; }
            
            // 5. 적 이동 및 사망 처리
            enemies.forEach((en, i) => { 
                en.y += en.spd; 
                if (en.y > 650) enemies.splice(i, 1);
                if (Math.hypot(player.x - en.x, player.y - en.y) < 45) location.reload(); 
            });

            score += 0.1; scoreEl.innerText = Math.floor(score);

            // --- 6. 렌더링 (모든 좌표 고정!) ---
            ctx.clearRect(0, 0, 800, 600);
            
            // [6-1] 왼쪽: 전투 구역 (숲 사진 고정)
            if (img.bg.complete) {
                ctx.drawImage(img.bg, 0, 0, BATTLE_W, 600);
            }

            // [6-2] 오른쪽: 쇼케이스 구역 (검은 칸 고정)
            ctx.fillStyle = "#050505"; ctx.fillRect(BATTLE_W, 0, SHOW_W, 600);
            
            // 황금 경계선 및 그리드
            ctx.strokeStyle = "#ffd700"; ctx.lineWidth = 4; ctx.strokeRect(BATTLE_W, 0, SHOW_W, 600);
            ctx.strokeStyle = "rgba(255, 215, 0, 0.1)"; ctx.lineWidth = 1;
            for(let x = BATTLE_W; x < 800; x += 40) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, 600); ctx.stroke(); }
            for(let y = 0; y < 600; y += 40) { ctx.beginPath(); ctx.moveTo(BATTLE_W, y); ctx.lineTo(800, y); ctx.stroke(); }

            // [6-3] 쇼케이스에 빛나는 동료들 (Glow 효과!)
            ctx.save();
            ctx.shadowBlur = 25;
            ctx.shadowColor = "#ffd700";
            gallery.forEach(item => {
                ctx.drawImage(item.img, item.x - 40, item.y - 40, 80, 80);
            });
            ctx.restore();

            // [6-4] 캐릭터 및 총알 (피카츄는 빛 안남)
            ctx.fillStyle = "yellow"; 
            bullets.forEach(b => { ctx.beginPath(); ctx.arc(b.x, b.y, 6, 0, Math.PI*2); ctx.fill(); });
            enemies.forEach(en => ctx.drawImage(img.enemy, en.x-40, en.y-40, 80, 80));
            ctx.drawImage(img.player, player.x-50, player.y-50, 100, 100);

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>